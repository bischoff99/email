{"version":3,"file":"search-docs-DIm3ykOg.js","names":["context: ServerContext"],"sources":["../src/tools/search-docs.ts"],"sourcesContent":["import { z } from \"zod\";\nimport { defineTool } from \"./utils/defineTool\";\nimport { fetchWithTimeout } from \"./utils/fetch-utils\";\nimport { ApiError } from \"../api-client/index\";\nimport type { ServerContext } from \"../types\";\nimport type { SearchResponse } from \"./types\";\nimport { ParamSentryGuide } from \"../schema\";\n\nexport default defineTool({\n  name: \"search_docs\",\n  description: [\n    \"Search Sentry documentation for SDK setup, instrumentation, and configuration guidance.\",\n    \"\",\n    \"Use this tool when you need to:\",\n    \"- Set up Sentry SDK in any language (Python, JavaScript, Go, Ruby, etc.)\",\n    \"- Configure specific features like performance monitoring, error sampling, or release tracking\",\n    \"- Implement custom instrumentation (spans, transactions, breadcrumbs)\",\n    \"- Set up integrations with frameworks (Django, Flask, Express, Next.js, etc.)\",\n    \"- Configure data scrubbing, filtering, or sampling rules\",\n    \"- Troubleshoot SDK issues or find best practices\",\n    \"\",\n    \"This tool searches technical documentation, NOT general information about Sentry as a company.\",\n    \"\",\n    \"<examples>\",\n    \"### Setting up Sentry in a Python Django app\",\n    \"\",\n    \"```\",\n    \"search_docs(query='Django setup configuration SENTRY_DSN', guide='python/django')\",\n    \"```\",\n    \"\",\n    \"### Setting up source maps for Next.js\",\n    \"\",\n    \"```\",\n    \"search_docs(query='source maps webpack upload', guide='javascript/nextjs')\",\n    \"```\",\n    \"\",\n    \"### Configuring release tracking\",\n    \"\",\n    \"```\",\n    \"search_docs(query='release tracking deployment integration CI/CD')\",\n    \"```\",\n    \"</examples>\",\n    \"\",\n    \"<hints>\",\n    \"- Use guide parameter to filter results to specific technologies (e.g., 'javascript' or 'javascript/nextjs')\",\n    \"- Include the programming language/framework in your query for SDK-specific results\",\n    \"- Use technical terms like 'instrumentation', 'spans', 'transactions' for performance docs\",\n    \"- Include specific feature names like 'beforeSend', 'tracesSampleRate', 'SENTRY_DSN'\",\n    \"</hints>\",\n  ].join(\"\\n\"),\n  inputSchema: {\n    query: z\n      .string()\n      .trim()\n      .min(\n        2,\n        \"Search query is too short. Please provide at least 2 characters.\",\n      )\n      .max(\n        200,\n        \"Search query is too long. Please keep your query under 200 characters.\",\n      )\n      .describe(\n        \"The search query in natural language. Be specific about what you're looking for.\",\n      ),\n    maxResults: z\n      .number()\n      .int()\n      .min(1)\n      .max(10)\n      .default(3)\n      .describe(\"Maximum number of results to return (1-10)\")\n      .optional(),\n    guide: ParamSentryGuide.optional(),\n  },\n  async handler(params, context: ServerContext) {\n    let output = `# Documentation Search Results\\n\\n`;\n    output += `**Query**: \"${params.query}\"\\n`;\n    if (params.guide) {\n      output += `**Guide**: ${params.guide}\\n`;\n    }\n    output += `\\n`;\n\n    // Determine the URL - use context.mcpUrl if available, otherwise default to production\n    const host = context.mcpUrl || \"https://mcp.sentry.dev\";\n    const searchUrl = new URL(\"/api/search\", host);\n\n    const response = await fetchWithTimeout(\n      searchUrl.toString(),\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          query: params.query,\n          maxResults: params.maxResults,\n          guide: params.guide,\n        }),\n      },\n      15000, // 15 second timeout\n    );\n\n    if (!response.ok) {\n      // TODO: improve error responses with types\n      const errorData = (await response.json().catch(() => null)) as {\n        error?: string;\n      } | null;\n\n      const errorMessage =\n        errorData?.error || `Search failed with status ${response.status}`;\n      throw new ApiError(errorMessage, response.status);\n    }\n\n    const data = (await response.json()) as SearchResponse;\n\n    // Handle error in response\n    if (\"error\" in data && data.error) {\n      output += `**Error**: ${data.error}\\n\\n`;\n      return output;\n    }\n\n    // Display results\n    if (data.results.length === 0) {\n      output += \"No documentation found matching your query.\\n\\n\";\n      return output;\n    }\n\n    output += `Found ${data.results.length} match${data.results.length === 1 ? \"\" : \"es\"}\\n\\n`;\n\n    output += `These are just snippets. Use \\`get_doc(path='...')\\` to fetch the full content.\\n\\n`;\n\n    for (const [index, result] of data.results.entries()) {\n      output += `## ${index + 1}. ${result.url}\\n\\n`;\n      output += `**Path**: ${result.id}\\n`;\n      output += `**Relevance**: ${(result.relevance * 100).toFixed(1)}%\\n\\n`;\n      if (index < 3) {\n        output += \"**Matching Context**\\n\";\n        output += `> ${result.snippet.replace(/\\n/g, \"\\n> \")}\\n\\n`;\n      }\n    }\n\n    return output;\n  },\n});\n"],"mappings":";;;;;;;AAQA,0BAAe,WAAW;CACxB,MAAM;CACN,aAAa;EACX;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;CACD,EAAC,KAAK,KAAK;CACZ,aAAa;EACX,OAAO,EACJ,QAAQ,CACR,MAAM,CACN,IACC,GACA,mEACD,CACA,IACC,KACA,yEACD,CACA,SACC,mFACD;EACH,YAAY,EACT,QAAQ,CACR,KAAK,CACL,IAAI,EAAE,CACN,IAAI,GAAG,CACP,QAAQ,EAAE,CACV,SAAS,6CAA6C,CACtD,UAAU;EACb,OAAO,iBAAiB,UAAU;CACnC;CACD,MAAM,QAAQ,QAAQA,SAAwB;EAC5C,IAAI,UAAU;AACd,aAAW,cAAc,OAAO,MAAM;AACtC,MAAI,OAAO,MACT,YAAW,aAAa,OAAO,MAAM;AAEvC,aAAW;EAGX,MAAM,OAAO,QAAQ,UAAU;EAC/B,MAAM,YAAY,IAAI,IAAI,eAAe;EAEzC,MAAM,WAAW,MAAM,iBACrB,UAAU,UAAU,EACpB;GACE,QAAQ;GACR,SAAS,EACP,gBAAgB,mBACjB;GACD,MAAM,KAAK,UAAU;IACnB,OAAO,OAAO;IACd,YAAY,OAAO;IACnB,OAAO,OAAO;GACf,EAAC;EACH,GACD,KACD;AAED,OAAK,SAAS,IAAI;GAEhB,MAAM,YAAa,MAAM,SAAS,MAAM,CAAC,MAAM,MAAM,KAAK;GAI1D,MAAM,eACJ,WAAW,UAAU,4BAA4B,SAAS;AAC5D,SAAM,IAAI,SAAS,cAAc,SAAS;EAC3C;EAED,MAAM,OAAQ,MAAM,SAAS,MAAM;AAGnC,MAAI,WAAW,QAAQ,KAAK,OAAO;AACjC,cAAW,aAAa,KAAK,MAAM;AACnC,UAAO;EACR;AAGD,MAAI,KAAK,QAAQ,WAAW,GAAG;AAC7B,aAAU;AACV,UAAO;EACR;AAED,aAAW,QAAQ,KAAK,QAAQ,OAAO,QAAQ,KAAK,QAAQ,WAAW,IAAI,KAAK,KAAK;AAErF,aAAW;AAEX,OAAK,MAAM,CAAC,OAAO,OAAO,IAAI,KAAK,QAAQ,SAAS,EAAE;AACpD,cAAW,KAAK,QAAQ,EAAE,IAAI,OAAO,IAAI;AACzC,cAAW,YAAY,OAAO,GAAG;AACjC,cAAW,iBAAiB,CAAC,OAAO,YAAY,KAAK,QAAQ,EAAE,CAAC;AAChE,OAAI,QAAQ,GAAG;AACb,cAAU;AACV,eAAW,IAAI,OAAO,QAAQ,QAAQ,OAAO,OAAO,CAAC;GACtD;EACF;AAED,SAAO;CACR;AACF,EAAC"}