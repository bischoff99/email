{"version":3,"file":"formatters-DbqofIoy.cjs","names":["issues: Issue[]","organizationSlug: string","projectSlugOrId: string | undefined","query: string","regionUrl?: string","naturalLanguageQuery?: string","dateString?: string | null"],"sources":["../src/tools/search-issues/formatters.ts"],"sourcesContent":["import type { Issue } from \"../../api-client\";\nimport { getIssueUrl, getIssuesSearchUrl } from \"../../utils/url-utils\";\nimport * as Sentry from \"@sentry/node\";\n\n/**\n * Format issue search results for display\n */\nexport function formatIssueResults(\n  issues: Issue[],\n  organizationSlug: string,\n  projectSlugOrId: string | undefined,\n  query: string,\n  regionUrl?: string,\n  naturalLanguageQuery?: string,\n  skipHeader = false,\n): string {\n  const host = regionUrl ? new URL(regionUrl).host : \"sentry.io\";\n\n  let output = \"\";\n\n  // Skip header section if requested (when called from handler with includeExplanation)\n  if (!skipHeader) {\n    // Use natural language query in title if provided, otherwise fall back to org/project\n    if (naturalLanguageQuery) {\n      output = `# Search Results for \"${naturalLanguageQuery}\"\\n\\n`;\n    } else {\n      output = `# Issues in **${organizationSlug}`;\n      if (projectSlugOrId) {\n        output += `/${projectSlugOrId}`;\n      }\n      output += \"**\\n\\n\";\n    }\n\n    // Add display instructions for UI\n    output += `âš ï¸ **IMPORTANT**: Display these issues as highlighted cards with status indicators, assignee info, and clickable Issue IDs.\\n\\n`;\n  }\n\n  if (issues.length === 0) {\n    Sentry.logger.info(\n      Sentry.logger\n        .fmt`No issues found for query: ${naturalLanguageQuery || query}`,\n      {\n        query: query,\n        organizationSlug: organizationSlug,\n        projectSlug: projectSlugOrId,\n        naturalLanguageQuery: naturalLanguageQuery,\n      },\n    );\n    output += \"No issues found matching your search criteria.\\n\\n\";\n    output += \"Try adjusting your search criteria or time range.\";\n    return output;\n  }\n\n  // Generate search URL for viewing results\n  const searchUrl = getIssuesSearchUrl(\n    host,\n    organizationSlug,\n    query,\n    projectSlugOrId,\n  );\n\n  // Add view link with emoji and guidance text (like search_events)\n  output += `**ðŸ“Š View these results in Sentry**: ${searchUrl}\\n`;\n  output += `_Please share this link with the user to view the search results in their Sentry dashboard._\\n\\n`;\n\n  output += `Found **${issues.length}** issue${issues.length === 1 ? \"\" : \"s\"}:\\n\\n`;\n\n  // Format each issue\n  issues.forEach((issue, index) => {\n    // Generate issue URL using the utility function\n    const issueUrl = getIssueUrl(host, organizationSlug, issue.shortId);\n\n    output += `## ${index + 1}. [${issue.shortId}](${issueUrl})\\n\\n`;\n    output += `**${issue.title}**\\n\\n`;\n\n    // Issue metadata\n    // Issues don't have a level field in the API response\n    output += `- **Status**: ${issue.status}\\n`;\n    output += `- **Users**: ${issue.userCount || 0}\\n`;\n    output += `- **Events**: ${issue.count || 0}\\n`;\n\n    if (issue.assignedTo) {\n      const assignee = issue.assignedTo;\n      if (typeof assignee === \"string\") {\n        output += `- **Assigned to**: ${assignee}\\n`;\n      } else if (\n        assignee &&\n        typeof assignee === \"object\" &&\n        \"name\" in assignee\n      ) {\n        output += `- **Assigned to**: ${assignee.name}\\n`;\n      }\n    }\n\n    output += `- **First seen**: ${formatDate(issue.firstSeen)}\\n`;\n    output += `- **Last seen**: ${formatDate(issue.lastSeen)}\\n`;\n\n    if (issue.culprit) {\n      output += `- **Culprit**: \\`${issue.culprit}\\`\\n`;\n    }\n\n    output += \"\\n\";\n  });\n\n  // Add next steps section (like search_events)\n  output += \"## Next Steps\\n\\n\";\n  output +=\n    \"- Get more details about a specific issue: Use the Issue ID with get_issue_details\\n\";\n  output +=\n    \"- Update issue status: Use update_issue to resolve or assign issues\\n\";\n  output +=\n    \"- View event counts: Use search_events for aggregated statistics\\n\";\n\n  return output;\n}\n\n/**\n * Format date for display\n */\nfunction formatDate(dateString?: string | null): string {\n  if (!dateString) return \"N/A\";\n\n  const date = new Date(dateString);\n  const now = new Date();\n  const diffMs = now.getTime() - date.getTime();\n  const diffHours = Math.floor(diffMs / (1000 * 60 * 60));\n\n  if (diffHours < 1) {\n    const diffMinutes = Math.floor(diffMs / (1000 * 60));\n    return `${diffMinutes} minute${diffMinutes === 1 ? \"\" : \"s\"} ago`;\n  }\n  if (diffHours < 24) {\n    return `${diffHours} hour${diffHours === 1 ? \"\" : \"s\"} ago`;\n  }\n  const diffDays = Math.floor(diffHours / 24);\n  if (diffDays < 30) {\n    return `${diffDays} day${diffDays === 1 ? \"\" : \"s\"} ago`;\n  }\n  return date.toLocaleDateString();\n}\n"],"mappings":";;;;;;;;AAOA,SAAgB,mBACdA,QACAC,kBACAC,iBACAC,OACAC,WACAC,sBACA,aAAa,OACL;CACR,MAAM,OAAO,YAAY,IAAI,IAAI,WAAW,OAAO;CAEnD,IAAI,SAAS;AAGb,MAAK,YAAY;AAEf,MAAI,qBACF,WAAU,wBAAwB,qBAAqB;OAClD;AACL,aAAU,gBAAgB;AAC1B,OAAI,gBACF,YAAW,GAAG;AAEhB,aAAU;EACX;AAGD,aAAW;CACZ;AAED,KAAI,OAAO,WAAW,GAAG;AACvB,gBAAO,OAAO,KACZ,cAAO,OACJ,IAAI,6BAA6B,wBAAwB,SAC5D;GACS;GACW;GAClB,aAAa;GACS;EACvB,EACF;AACD,YAAU;AACV,YAAU;AACV,SAAO;CACR;CAGD,MAAM,YAAY,qCAChB,MACA,kBACA,OACA,gBACD;AAGD,YAAW,uCAAuC,UAAU;AAC5D,YAAW;AAEX,YAAW,UAAU,OAAO,OAAO,UAAU,OAAO,WAAW,IAAI,KAAK,IAAI;AAG5E,QAAO,QAAQ,CAAC,OAAO,UAAU;EAE/B,MAAM,WAAW,8BAAY,MAAM,kBAAkB,MAAM,QAAQ;AAEnE,aAAW,KAAK,QAAQ,EAAE,KAAK,MAAM,QAAQ,IAAI,SAAS;AAC1D,aAAW,IAAI,MAAM,MAAM;AAI3B,aAAW,gBAAgB,MAAM,OAAO;AACxC,aAAW,eAAe,MAAM,aAAa,EAAE;AAC/C,aAAW,gBAAgB,MAAM,SAAS,EAAE;AAE5C,MAAI,MAAM,YAAY;GACpB,MAAM,WAAW,MAAM;AACvB,cAAW,aAAa,SACtB,YAAW,qBAAqB,SAAS;YAEzC,mBACO,aAAa,YACpB,UAAU,SAEV,YAAW,qBAAqB,SAAS,KAAK;EAEjD;AAED,aAAW,oBAAoB,WAAW,MAAM,UAAU,CAAC;AAC3D,aAAW,mBAAmB,WAAW,MAAM,SAAS,CAAC;AAEzD,MAAI,MAAM,QACR,YAAW,mBAAmB,MAAM,QAAQ;AAG9C,YAAU;CACX,EAAC;AAGF,WAAU;AACV,WACE;AACF,WACE;AACF,WACE;AAEF,QAAO;AACR;;;;AAKD,SAAS,WAAWC,YAAoC;AACtD,MAAK,WAAY,QAAO;CAExB,MAAM,OAAO,IAAI,KAAK;CACtB,MAAM,sBAAM,IAAI;CAChB,MAAM,SAAS,IAAI,SAAS,GAAG,KAAK,SAAS;CAC7C,MAAM,YAAY,KAAK,MAAM,UAAU,MAAO,KAAK,IAAI;AAEvD,KAAI,YAAY,GAAG;EACjB,MAAM,cAAc,KAAK,MAAM,UAAU,MAAO,IAAI;AACpD,YAAU,YAAY,SAAS,gBAAgB,IAAI,KAAK,IAAI;CAC7D;AACD,KAAI,YAAY,GACd,WAAU,UAAU,OAAO,cAAc,IAAI,KAAK,IAAI;CAExD,MAAM,WAAW,KAAK,MAAM,YAAY,GAAG;AAC3C,KAAI,WAAW,GACb,WAAU,SAAS,MAAM,aAAa,IAAI,KAAK,IAAI;AAErD,QAAO,KAAK,oBAAoB;AACjC"}