{"version":3,"file":"content/extract-content.js","sources":["webpack://@agent-infra/browser-context/webpack/runtime/define_property_getters","webpack://@agent-infra/browser-context/webpack/runtime/has_own_property","webpack://@agent-infra/browser-context/webpack/runtime/make_namespace_object","webpack://@agent-infra/browser-context/./src/content/extract-content.ts"],"sourcesContent":["__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n        if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n            Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n        }\n    }\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/*\n * Copyright (c) 2025 Bytedance, Inc. and its affiliates.\n * SPDX-License-Identifier: Apache-2.0\n */\nimport type { Page } from 'puppeteer-core';\nimport { Defuddle, DefuddleOptions } from 'defuddle/node';\nimport { READABILITY_SCRIPT } from './readability-script.js';\nimport { toMarkdown } from './to-markdown.js';\n\nexport const extractWithReadability = async (\n  page: Page,\n  options: {\n    markdown?: boolean;\n  } = {},\n): Promise<{ title: string; content: string }> => {\n  // Extract content using Readability algorithm on a document clone to prevent DOM flickering\n  const extractionResult = await page.evaluate((readabilityScript) => {\n    // Initialize Readability from script\n    const Readability = new Function(\n      'module',\n      `${readabilityScript}\\nreturn module.exports`,\n    )({});\n\n    // Create a deep clone of the document to avoid modifying the visible DOM\n    const documentClone = document.cloneNode(true) as Document;\n\n    // Clean up the cloned document\n    documentClone\n      .querySelectorAll(\n        'script,noscript,style,link,svg,img,video,iframe,canvas,.reflist',\n      )\n      .forEach((el) => el.remove());\n\n    // Parse content from the clone\n    const article = new Readability(documentClone).parse();\n    const content = article?.content || '';\n    const title = document.title;\n\n    return {\n      content,\n      title: article?.title || title,\n    };\n  }, READABILITY_SCRIPT);\n\n  return options?.markdown\n    ? {\n        title: extractionResult.title,\n        content: toMarkdown(extractionResult.content),\n      }\n    : extractionResult;\n};\n\nexport const extractWithDefuddle = async (\n  html: string,\n  url: string,\n  options: DefuddleOptions,\n): Promise<{ title: string; content: string }> => {\n  const { title, content } = await Defuddle(html, url, options);\n\n  return {\n    title,\n    content,\n  };\n};\n\n/**\n * Extract content from a page using Defuddle or Readability\n * page html -> markdown\n * @param page - The page to extract content from\n * @returns The title and content of the page\n */\nexport const extractContent = async (\n  page: Page,\n): Promise<{ title: string; content: string }> => {\n  const pageSourceHTML = await page.content();\n\n  try {\n    return await extractWithDefuddle(pageSourceHTML, page.url(), {\n      markdown: true,\n    });\n  } catch (e) {\n    return await extractWithReadability(page as any, {\n      markdown: true,\n    });\n  }\n};\n"],"names":["__webpack_require__","definition","key","Object","obj","prop","Symbol","extractWithReadability","page","options","extractionResult","readabilityScript","Readability","Function","documentClone","document","el","article","content","title","READABILITY_SCRIPT","toMarkdown","extractWithDefuddle","html","url","Defuddle","extractContent","pageSourceHTML","e"],"mappings":";;;;;;;IAAAA,oBAAoB,CAAC,GAAG,CAAC,UAASC;QACjC,IAAI,IAAIC,OAAOD,WACR,IAAGD,oBAAoB,CAAC,CAACC,YAAYC,QAAQ,CAACF,oBAAoB,CAAC,CAAC,UAASE,MACzEC,OAAO,cAAc,CAAC,UAASD,KAAK;YAAE,YAAY;YAAM,KAAKD,UAAU,CAACC,IAAI;QAAC;IAGzF;;;ICNAF,oBAAoB,CAAC,GAAG,CAACI,KAAKC,OAAUF,OAAO,SAAS,CAAC,cAAc,CAAC,IAAI,CAACC,KAAKC;;;ICClFL,oBAAoB,CAAC,GAAG,CAAC;QACxB,IAAG,AAAkB,eAAlB,OAAOM,UAA0BA,OAAO,WAAW,EACrDH,OAAO,cAAc,CAAC,UAASG,OAAO,WAAW,EAAE;YAAE,OAAO;QAAS;QAEtEH,OAAO,cAAc,CAAC,UAAS,cAAc;YAAE,OAAO;QAAK;IAC5D;;;;;;;;;;;;ACGO,MAAMI,yBAAyB,OACpCC,MACAC,UAEI,CAAC,CAAC;IAGN,MAAMC,mBAAmB,MAAMF,KAAK,QAAQ,CAAC,CAACG;QAE5C,MAAMC,cAAc,IAAIC,SACtB,UACA,GAAGF,kBAAkB,uBAAuB,CAAC,EAC7C,CAAC;QAGH,MAAMG,gBAAgBC,SAAS,SAAS,CAAC;QAGzCD,cACG,gBAAgB,CACf,mEAED,OAAO,CAAC,CAACE,KAAOA,GAAG,MAAM;QAG5B,MAAMC,UAAU,IAAIL,YAAYE,eAAe,KAAK;QACpD,MAAMI,UAAUD,AAAAA,CAAAA,QAAAA,UAAAA,KAAAA,IAAAA,QAAS,OAAO,AAAD,KAAK;QACpC,MAAME,QAAQJ,SAAS,KAAK;QAE5B,OAAO;YACLG;YACA,OAAOD,AAAAA,CAAAA,QAAAA,UAAAA,KAAAA,IAAAA,QAAS,KAAK,AAAD,KAAKE;QAC3B;IACF,GAAGC,+CAAAA,kBAAkBA;IAErB,OAAOX,AAAAA,CAAAA,QAAAA,UAAAA,KAAAA,IAAAA,QAAS,QAAQ,AAAD,IACnB;QACE,OAAOC,iBAAiB,KAAK;QAC7B,SAASW,AAAAA,IAAAA,wCAAAA,UAAAA,AAAAA,EAAWX,iBAAiB,OAAO;IAC9C,IACAA;AACN;AAEO,MAAMY,sBAAsB,OACjCC,MACAC,KACAf;IAEA,MAAM,EAAEU,KAAK,EAAED,OAAO,EAAE,GAAG,MAAMO,AAAAA,IAAAA,qBAAAA,QAAAA,AAAAA,EAASF,MAAMC,KAAKf;IAErD,OAAO;QACLU;QACAD;IACF;AACF;AAQO,MAAMQ,iBAAiB,OAC5BlB;IAEA,MAAMmB,iBAAiB,MAAMnB,KAAK,OAAO;IAEzC,IAAI;QACF,OAAO,MAAMc,oBAAoBK,gBAAgBnB,KAAK,GAAG,IAAI;YAC3D,UAAU;QACZ;IACF,EAAE,OAAOoB,GAAG;QACV,OAAO,MAAMrB,uBAAuBC,MAAa;YAC/C,UAAU;QACZ;IACF;AACF"}